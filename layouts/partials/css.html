{{ $devMode      := site.IsServer }}
{{ $includePaths := (slice "node_modules") }}
{{ $scss         := "scss/style.scss" }}
{{ $cssOutput    := "css/style.css" }}
{{/* CSS dev mode: sourcemaps */}}
{{ $devOpts      := dict "targetPath" $cssOutput "includePaths" $includePaths "enableSourceMap" true }}
{{/* CSS prod mode: sourcemaps and minified */}}
{{ $prodOpts     := dict "targetPath" $cssOutput "includePaths" $includePaths "enableSourceMap" true "outputStyle" "compressed" }}
{{/* Activate dev mode only when running `hugo server` */}}
{{ $cssOpts      := cond $devMode $devOpts $prodOpts }}
{{ $css          := resources.Get $scss | resources.ExecuteAsTemplate $scss . | toCSS $cssOpts }}

{{ if $devMode }}
<link rel="stylesheet" href="{{ $css.RelPermalink }}">
{{ else }}
{{/* For prod mode, add a SHA fingerprint */}}
{{ $prodCss      := $css | resources.PostCSS | resources.Fingerprint "sha512" }}
<link rel="stylesheet" href="{{ $prodCss.RelPermalink }}" integrity="{{ $prodCss.Data.Integrity }}">
{{ end }}
